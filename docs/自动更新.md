# 应用自动更新

Electron 提供了自动更新，但其功能有限，我们使用的是第三方的 `electron-updater`。

## 实现流程
在 `package.json` 中定义更新的应用的地址。
`url` 在项目开发中为 mock 地址。

```
"publish": [
      {
        "provider": "generic",
        "url": "http://127.0.0.1:8080/"
      }
    ],
```

### 检测是否有版本更新

引入`electron-updater`，检测是否有新版本。

```
const { autoUpdater } = require('electron-updater');
autoUpdater.checkForUpdates();
```

### 监听检测情况

Event: checking-for-update: 当检测开始时触发
Event: update-available: 有更版本软件时触发
Event: update-not-available: 检测到没有新版本时触发
Evnet: download-progress: 检测下载进度
Event: update-downloaded: 当下载完毕时

当设置为不是自动下载时，需要手动触发下载。
在本项目中，没有设定为自动下载，因此需要设置

```
autoUpdater.autoDownload = false;
```

检测到有新版本后，通过以下代码触发下载
```
autoUpdater.downloadUpdate().then()
```

下载完成后, 下载并安装
```
autoUpdater.quitAndInstall();
```

详细的代码: 见
```
+-- src
|   +-- main
|   |   +-- update.j
```


## 待优化的地方

electron-updater 对 release 发布的文案不友好，只支持 github 的 changelog。
